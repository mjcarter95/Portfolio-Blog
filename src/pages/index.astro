---
import { slugifyTag } from "@/utils/tags";
import Hero from "@/components/Hero.astro";
import BaseLayout from "@/layouts/BaseLayout.astro";
import Section from "@/components/Section.astro";

// Helper: "YYYY-MM-DD" -> "Month Year"
const formatDisplayDate = (raw) =>
  raw ? new Date(String(raw).trim()).toLocaleString("en-US", { month: "long", year: "numeric" }) : "";

// Publications (expects frontmatter.date)
const allPublications = await Astro.glob('../content/publications/*.md');
const sortedPublications = allPublications
  .sort((a, b) => new Date(b.frontmatter.date) - new Date(a.frontmatter.date))
  .slice(0, 3);

// Writing (expects frontmatter.date)
const allWriting = await Astro.glob('../content/writing/*.md');
const recentWriting = allWriting
  .sort((a, b) => new Date(b.frontmatter.date) - new Date(a.frontmatter.date))
  .slice(0, 3);
---

<BaseLayout title="Home - Matthew Carter" navTone="light">
  <Hero>
    <h1 class="text-4xl md:text-6xl font-semibold tracking-tight">
      Hey, I’m Matthew.
    </h1>

    <div class="mt-4 w-16"></div>

    <p class="mt-5 text-lg md:text-xl text-white/90 leading-relaxed">
      I help practitioners and researchers make fast, data-informed decisions in the face of uncertainty.
    </p>
  </Hero>

  <!-- Specialisations -->
  <Section tone="light" id="specialisations">
    <div class="text-center max-w-2xl mx-auto">
      <h2 class="text-3xl font-semibold tracking-tight">Specialisations</h2>
      <p class="mt-4 text-gray-600 text-lg">
        I combine artificial intelligence, Bayesian inference, and advanced computing to deliver robust, high-performance solutions.
      </p>
    </div>

    <div class="mt-16 grid md:grid-cols-3 gap-10">
      <div class="bg-gray-50 p-8 rounded-2xl shadow-sm hover:shadow-lg transition text-center">
        <div class="w-16 h-16 bg-white rounded-full flex items-center justify-center shadow-md mx-auto">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 text-blue-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 7h16M4 12h8m-8 5h16" />
          </svg>
        </div>
        <h3 class="mt-6 text-xl font-semibold">Data-Driven Decision Systems</h3>
        <p class="mt-3 text-gray-600">Build intelligent, scalable pipelines that transform raw data into actionable insights.</p>
      </div>

      <div class="bg-white p-8 rounded-2xl shadow-sm hover:shadow-lg transition text-center">
        <div class="w-16 h-16 bg-gray-50 rounded-full flex items-center justify-center shadow-md mx-auto">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 text-green-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 20c3-8 6-12 9-12s6 4 9 12" />
          </svg>
        </div>
        <h3 class="mt-6 text-xl font-semibold">Capturing Uncertainty</h3>
        <p class="mt-3 text-gray-600">Quantify and communicate confidence using Bayesian models and probabilistic inference.</p>
      </div>

      <div class="bg-gray-50 p-8 rounded-2xl shadow-sm hover:shadow-lg transition text-center">
        <div class="w-16 h-16 bg-white rounded-full flex items-center justify-center shadow-md mx-auto">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 text-yellow-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
          </svg>
        </div>
        <h3 class="mt-6 text-xl font-semibold">Fast Decisions</h3>
        <p class="mt-3 text-gray-600">Leverage race-tuned algorithms on GPUs, TPUs, and distributed clusters for near real-time results.</p>
      </div>
    </div>
  </Section>

  <!-- About -->
  <Section tone="alt" id="about">
    <div class="grid grid-cols-1 md:grid-cols-12 gap-12 items-center">
      <div class="md:col-span-8">
        <h2 class="text-2xl md:text-3xl font-semibold tracking-tight">About</h2>
          <p class="mt-6 text-gray-700 leading-relaxed">
            I am a researcher in the 
            <a href="https://www.liverpool.ac.uk/electrical-engineering-and-electronics/research/signal-processing/" target="_blank" rel="noopener" class="font-semibold decoration-2 hover:text-[#996633]">Signal Processing Group</a> 
            at the 
            <a href="https://www.liverpool.ac.uk/" target="_blank" rel="noopener" class="font-semibold decoration-2 hover:text-[#996633]">University of Liverpool</a>, 
            passionate about enabling practitioners and researchers to make fast, data-informed decisions in the face of uncertainty.
            My research interests span <span class="font-medium">artificial intelligence</span>, <span class="font-medium">Bayesian inference</span>, and
            <span class="font-medium">high-performance computing and distributed</span>, with a focus on combining these fields to create powerful, efficient decision-making systems.
          </p>

          <p class="mt-4 text-gray-700 leading-relaxed">
            I completed my undergraduate degree in Business Economics and Financial Management at the University of Hull in 2018. I then earned my MSc in Big Data and High-Performance Computing from the University of Liverpool in 2019. In 2025, I achieved my PhD in Electrical Engineering and Electronics at the University of Liverpool, where my thesis focused on developing advanced numerical Bayesian inference techniques that capitalised on high-performance and distributed computing environments.
          </p>

          <p class="mt-4 text-gray-700 leading-relaxed">
            In my spare time, I enjoy playing instruments including the clarinet, saxophone, and guitar. 
            One of my favourite pieces to play is <em>Si Tu Vois Ma Mère</em> by Sidney Bechet; I love it for the emotive, almost voice-like quality of the clarinet that speaks without words. 
            When I'm not playing, I enjoy taking photographs and writing poetry. You can see some of my creative work on
            <a href="https://www.instagram.com/mjc.dng/" target="_blank" rel="noopener" class="font-semibold decoration-2 hover:text-[#996633]">Instagram</a>. 
            I am also an avid gamer, regularly playing Vermintide and Counter-Strike.
          </p>
        <div class="mt-8">
          <a href="/about" class="inline-block font-semibold decoration-2 hover:text-[#996633]">Read full bio →</a>
        </div>
      </div>

      <div class="md:col-span-4">
        <img src="/images/me.jpg" alt="Portrait of Matthew Carter" class="w-full max-w-md h-auto md:ml-auto shadow-lg object-contain bg-gray-200" />
      </div>
    </div>
  </Section>

  <!-- Recent Publications -->
  <Section tone="light" id="recent-publications">
    <h2 class="text-2xl md:text-3xl font-semibold tracking-tight mb-10">Recent Publications</h2>

    <div class="space-y-10">
      {sortedPublications.map((pub) => {
        const { title, authors = [], venue = "", type = "", url = "", pdf = "", date } = pub.frontmatter;
        const linkTarget = url || pdf || "#";
        const displayDate = formatDisplayDate(date);
        const formattedAuthors = authors.map(a => a === "Matthew Carter" ? `<strong>${a}</strong>` : a).join(", ");

        return (
          <div class="border-b border-gray-200 pb-6">
            <h3 class="text-lg md:text-xl font-semibold text-gray-900 leading-snug">
              <a href={linkTarget} target="_blank" rel="noopener" class="hover:text-[#996633]">{title}</a>
            </h3>
            <p class="mt-1 text-sm text-gray-600">
              <span set:html={formattedAuthors}></span> &middot; <span class="italic">{venue}</span> &middot; <span>{type}</span> &middot; {displayDate}
            </p>
            {pub.frontmatter.description && (
              <p class="mt-3 text-gray-700 text-sm leading-relaxed">{pub.frontmatter.description}</p>
            )}
          </div>
        );
      })}
    </div>

    <div class="mt-10">
      <a href="/publications" class="inline-block font-semibold decoration-2 hover:text-[#996633]">View all publications →</a>
    </div>
  </Section>

  <!-- Photography Spotlight -->
  <Section tone="alt" id="highlighted-photos">
    <h2 class="text-2xl md:text-3xl font-semibold tracking-tight mb-10">Photography Spotlight</h2>

    <div class="grid md:grid-cols-3 gap-8">
      <a href="https://www.instagram.com/p/C6A52dWM6Ni/?img_index=1" target="_blank" rel="noopener" class="group">
        <img src="/images/spotlight/image1.jpg" alt="Photo 1" class="w-full h-auto shadow-lg object-cover aspect-square transition-transform duration-300 group-hover:scale-105" />
      </a>
      <a href="https://www.instagram.com/p/Cy2zpBMMK99/?img_index=2" target="_blank" rel="noopener" class="group">
        <img src="/images/spotlight/image2.jpg" alt="Photo 2" class="w-full h-auto shadow-lg object-cover aspect-square transition-transform duration-300 group-hover:scale-105" />
      </a>
      <a href="https://www.instagram.com/p/CvRD-mIL96f/" target="_blank" rel="noopener" class="group">
        <img src="/images/spotlight/image3.jpg" alt="Photo 3" class="w-full h-auto shadow-lg object-cover aspect-square transition-transform duration-300 group-hover:scale-105" />
      </a>
    </div>

    <div class="mt-8">
      <a href="https://www.instagram.com/mjc.dng/" target="_blank" rel="noopener" class="inline-block font-semibold decoration-2 hover:text-[#996633]">View more on Instagram →</a>
    </div>
  </Section>

  <!-- Recent Writing -->
  <Section tone="light" id="recent-writing">
    <h2 class="text-2xl md:text-3xl font-semibold tracking-tight mb-10">
      Recent Writing
    </h2>

    {recentWriting.length === 0 ? (
      <p class="text-gray-600">No posts yet.</p>
    ) : (
      <div class="space-y-10">
        {recentWriting.map((post) => {
          const {
            title,
            date,
            year,
            tags = [],
            url,
            description = "",
            summary = "",
          } = post.frontmatter;

          const displayDate = formatDisplayDate(date ?? year);
          const excerpt = summary || description;
          const slug = post.slug ?? post.file.split('/').pop().replace(/\.md$/, '');
          const postLink = `/writing/${slug}/`;

          return (
            <div class="border-b border-gray-200 pb-6">
              <h3 class="text-lg md:text-xl font-semibold text-gray-900 leading-snug">
                <a href={postLink} class="hover:text-[#996633]">
                  {title}
                </a>
              </h3>

              <div class="mt-1 text-sm text-gray-600 flex flex-wrap items-center gap-2">
                <span>{displayDate}</span>
                {tags.length > 0 && (
                  <>
                    <span>·</span>
                    <div class="flex flex-wrap gap-2">
                      {tags.map((tag) => (
                        <a
                          href={`/tags/${slugifyTag(tag)}`}
                          class="text-xs bg-gray-200 hover:bg-[#996633] hover:text-white px-2 py-0.5 rounded-full transition"
                        >
                          {tag}
                        </a>
                      ))}
                    </div>
                  </>
                )}
              </div>

              {excerpt && (
                <p class="mt-3 text-gray-700 text-sm leading-relaxed">
                  {excerpt}
                </p>
              )}
            </div>
          );
        })}
      </div>
    )}

    <div class="mt-10">
      <a href="/writing" class="inline-block font-semibold decoration-2 hover:text-[#996633]">
        View all writing →
      </a>
    </div>
  </Section>
</BaseLayout>
