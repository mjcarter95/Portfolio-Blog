---
const links = [
  { href: '/', label: 'Home' },
  { href: '/about', label: 'About' },
  { href: '/publications', label: 'Publications' },
  { href: '/case-studies', label: 'Case Studies' },
  { href: '/writing', label: 'Writing' },
  { href: '/photography', label: 'Photography' },
  { href: '/contact', label: 'Contact' },
];

const path = Astro.url.pathname;
const isActive = (href) => href === '/' ? path === '/' : (path === href || path.startsWith(href + '/'));

const { variant = "solid" } = Astro.props; // "overlay" | "solid"
---

<header id="main-header" data-variant={variant} data-solid="false">
  <a href="/" class="flex items-center gap-3">
    <img id="header-logo" src="/images/seo/logo_white.png" alt="Logo" class="h-12 w-auto" />
  </a>

  <nav class="hidden md:flex items-center gap-6 text-sm">
    {links.map(l => (
      <a href={l.href} aria-current={isActive(l.href) ? 'page' : undefined} class="nav-link font-bold relative pb-2">
        {l.label}
      </a>
    ))}
  </nav>

  <details class="md:hidden">
    <summary class="cursor-pointer select-none">Menu</summary>
    <div class="mt-2 flex flex-col gap-2">
      {links.map(l => <a href={l.href} class="py-1">{l.label}</a>)}
    </div>
  </details>
</header>

<style>
  /* Base header */
  #main-header{
    position: fixed; top:0; left:0; right:0; z-index:9999;
    display:flex; align-items:center; justify-content:space-between;
    padding: 1.25rem 1.5rem;
    transition: background .25s, color .25s, border-color .25s, padding .25s;
  }
  /* Spacer lives in BaseLayout */
  #header-spacer{ height:0; transition: height .25s; }

  /* Overlay (at top): transparent + white text */
  #main-header[data-variant="overlay"][data-solid="false"]{
    background: transparent; color:#fff; border-bottom-color: transparent;
  }
  /* Solid mode: white bg + dark text */
  #main-header[data-solid="true"]{
    background:#fff; color:#111827; border-bottom:1px solid #e5e7eb;
  }

  /* Links/underline */
  .nav-link{ color:inherit; text-decoration:none; transition: color .2s, opacity .2s; }
  .nav-link::after{
    content:""; position:absolute; left:0; bottom:0; height:2px; width:100%;
    background-color: transparent; opacity:0; transition: opacity .2s, background-color .2s;
  }
  .nav-link[aria-current="page"]{ color:#4C9141; }            /* may green */
  .nav-link[aria-current="page"]::after{ opacity:1; background-color:#4C9141; }
  #main-header .nav-link:hover::after{ opacity:1; background-color:#4C9141; }
</style>

<script>
  const header = document.getElementById('main-header');
  const logo   = document.getElementById('header-logo');
  const spacer = document.getElementById('header-spacer');
  const variant = header.getAttribute('data-variant') || 'solid';

  function paint(solid){
    header.setAttribute('data-solid', solid ? 'true' : 'false');
    if (solid){
      logo.src = '/images/seo/logo_black.png';
      if (spacer) spacer.style.height = header.getBoundingClientRect().height + 'px';
    } else {
      logo.src = '/images/seo/logo_white.png';
      if (spacer) spacer.style.height = '0px';
    }
  }

  function onScroll(){
    const solid = variant === 'overlay' ? (window.scrollY > 60) : true;
    paint(solid);
  }

  // Initial paint + listeners
  onScroll();
  window.addEventListener('scroll', onScroll, { passive:true });
  window.addEventListener('resize', onScroll);
</script>
